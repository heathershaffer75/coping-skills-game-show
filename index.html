<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Coping Skills Game Show: Will It Work?</title>
<style>
  :root{
    --bg:#0f1221;         /* deep indigo */
    --panel:#171a2e;      /* dark panel */
    --accent:#7dd3fc;     /* sky */
    --accent-2:#a78bfa;   /* violet */
    --good:#22c55e;       /* green */
    --warn:#fbbf24;       /* amber */
    --bad:#ef4444;        /* red */
    --text:#e5e7eb;       /* light */
    --muted:#a1a1aa;      /* gray */
  }
  html,body{height:100%;}
  body{
    margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    color:var(--text); background: radial-gradient(1000px 700px at 20% 0%, #1b2140 0%, var(--bg) 60%);
  }
  header{
    padding:24px 16px; text-align:center; border-bottom:1px solid #232645; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0));
  }
  h1{margin:0; font-size:clamp(20px, 3.2vw, 36px);} 
  .subtitle{color:var(--muted); margin-top:6px}
  .container{display:grid; gap:16px; padding:16px; grid-template-columns: 1.2fr 1fr;}
  @media (max-width: 980px){ .container{grid-template-columns: 1fr;} }
  .card{background:var(--panel); border:1px solid #222546; border-radius:16px; padding:16px; box-shadow: 0 6px 24px rgba(0,0,0,0.25);} 
  .section-title{font-size:18px; margin:0 0 12px 0; display:flex; align-items:center; gap:8px}
  button{appearance:none; border:1px solid #26325f; background:#1b2450; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; transition: transform .04s ease, box-shadow .2s ease, background .2s ease;}
  button:hover{box-shadow:0 6px 22px rgba(124, 58, 237, .25);}
  button:active{transform: translateY(1px);} 
  .btn-primary{ background: linear-gradient(180deg, #2a3a8b, #1e2a68); border-color:#3343a3; }
  .btn-good{ background: linear-gradient(180deg, #18763b, #0f5f2d); border-color:#1d8f48; }
  .btn-warn{ background: linear-gradient(180deg, #8b6a2a, #6a531e); border-color:#a37c33; }
  .btn-bad{  background: linear-gradient(180deg, #8b2a2a, #6a1e1e); border-color:#a33333; }
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  .pill{border:1px solid #2a305c; padding:8px 10px; border-radius:999px; background:#121632;}

  /* Wheel area */
  .wheel-wrap{display:grid; grid-template-columns: auto 1fr; gap:16px; align-items:center}
  #wheelCanvas{width:100%; max-width:420px; aspect-ratio:1 / 1; background:#0e1333; border-radius:50%; border:2px solid #2a2f59;}
  .pointer{width:0; height:0; border-left:14px solid transparent; border-right:14px solid transparent; border-bottom:26px solid var(--accent); margin:0 auto 8px; filter: drop-shadow(0 4px 8px rgba(125, 211, 252,.35));}

  .control-col .big-number{font-size:40px; font-weight:800; letter-spacing:1px}
  .muted{color:var(--muted)}

  .skill-card{min-height:120px; display:flex; align-items:center; justify-content:center; font-size:18px; padding:18px; border-radius:14px; border:1px dashed #30417a; background:#101736}
  .result-bad{color:var(--bad)}
  .result-good{color:var(--good)}
  .result-dep{color:var(--warn)}

  .vote-grid{display:grid; grid-template-columns: repeat(3, minmax(120px,1fr)); gap:10px}
  @media (max-width:560px){ .vote-grid{grid-template-columns: 1fr;} }
  .vote-card{padding:12px; border-radius:12px; border:1px solid #2a305c; background:#121632; text-align:center}
  .vote-card .count{font-size:28px; font-weight:800}

  .log{max-height:300px; overflow:auto; border-radius:12px; border:1px solid #262a54}
  table{width:100%; border-collapse:collapse}
  th, td{padding:10px; border-bottom:1px solid #21254b; text-align:left; vertical-align:top}
  th{position:sticky; top:0; background:#13183a}

  .badge{display:inline-flex; gap:6px; align-items:center; padding:4px 10px; border-radius:999px; font-size:12px; border:1px solid #2f376e; background:#0f1431}

  .footer-note{color:#9aa1b8; font-size:12px; text-align:center; margin:16px 0 24px}

  /* Modal */
  dialog{border:none; border-radius:16px; padding:0; max-width:820px; width:92vw; color:var(--text);}
  dialog::backdrop{background:rgba(5,6,10,.6)}
  .modal{background:var(--panel); border:1px solid #232645; border-radius:16px; overflow:hidden}
  .modal header{padding:16px; text-align:left}
  .modal .content{padding:16px}
  .modal textarea{width:100%; min-height:120px; resize:vertical; background:#0d1233; color:#fff; border:1px solid #25316b; border-radius:10px; padding:10px}

  .sponsor-toast{position:fixed; right:16px; bottom:16px; background:#121632; border:1px solid #2a305c; border-radius:14px; padding:12px 14px; display:flex; gap:10px; align-items:flex-start; max-width:320px; box-shadow:0 10px 30px rgba(0,0,0,.45)}
  .sponsor-toast .brand{font-weight:800; color:var(--accent)}

  .kbd{border:1px solid #2f376e; background:#0f1431; padding:2px 6px; border-radius:6px; font-size:12px}
</style>
</head>
<body>
  <header>
    <h1>üéÆ The Coping Skills Game Show: <em>Will It Work?</em></h1>
    <div class="subtitle">Match coping tools to emotional states ‚Ä¢ Debate, vote, learn ‚Ä¢ With very serious fake sponsors</div>
    <div class="subtitle" style="margin-top:8px">
      Shortcuts: <span class="kbd">S</span> Spin ‚Ä¢ <span class="kbd">D</span> Draw Skill ‚Ä¢ <span class="kbd">V</span> Sponsor ‚Ä¢ <span class="kbd">L</span> Log Round ‚Ä¢ <span class="kbd">/</span> Settings
    </div>
  </header>

  <main class="container" aria-live="polite">
    <!-- LEFT: Wheel, Winner, Controls -->
    <section class="card" aria-labelledby="wheel-title">
      <h2 id="wheel-title" class="section-title">üé° Wheel of Emotional States</h2>
      <div class="pointer" title="Pointer"></div>
      <div class="wheel-wrap">
        <canvas id="wheelCanvas" width="460" height="460" aria-label="Wheel of Emotional States" role="img"></canvas>
        <div class="control-col">
          <div class="muted">Current Emotion</div>
          <div id="currentEmotion" class="big-number">‚Äî</div>
          <div class="row" style="margin-top:10px">
            <button id="spinBtn" class="btn-primary" aria-label="Spin the wheel (S)">Spin Wheel</button>
            <button id="settingsBtn" aria-label="Open settings (/)" title="Lists & Settings">‚öôÔ∏è Lists</button>
          </div>
          <div style="margin-top:14px" class="muted">Tip: You can edit the emotions, skills, and sponsors in <strong>Lists</strong>.</div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Skill, Votes, Sponsor, Notes, Log -->
    <section class="card" aria-labelledby="round-title">
      <h2 id="round-title" class="section-title">üÉè Draw a Coping Skill & Debate</h2>
      <div class="row" style="align-items:stretch">
        <div style="flex:1; min-width:220px">
          <div class="muted">Drawn Skill</div>
          <div id="skillCard" class="skill-card" aria-live="polite">‚Äî</div>
          <div class="row" style="margin-top:10px">
            <button id="drawSkillBtn" class="btn-primary" aria-label="Draw skill (D)">Draw Skill</button>
            <button id="sponsorBtn" aria-label="Sponsor interruption (V)">üé§ Sponsor</button>
          </div>
        </div>
        <div style="flex:1; min-width:220px">
          <div class="muted">Group Vote</div>
          <div class="vote-grid" role="group" aria-label="Group vote: Will it work?">
            <div class="vote-card" id="voteYes">
              <div>‚úÖ Will Work</div>
              <div class="count" id="yesCount">0</div>
              <button class="btn-good" data-vote="yes">+1 Yes</button>
            </div>
            <div class="vote-card" id="voteNo">
              <div>‚ùå Won‚Äôt Work</div>
              <div class="count" id="noCount">0</div>
              <button class="btn-bad" data-vote="no">+1 No</button>
            </div>
            <div class="vote-card" id="voteDepends">
              <div>ü§î Depends</div>
              <div class="count" id="depCount">0</div>
              <button class="btn-warn" data-vote="dep">+1 Depends</button>
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <span class="badge" id="consensusBadge">Consensus: ‚Äî</span>
            <button id="resetVotesBtn">Reset Votes</button>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:14px">
        <label class="muted" for="notes">Notes / Tweaks / Barriers</label>
        <textarea id="notes" placeholder="E.g., breathing helps with panic physiology but shame needs values + self-compassion‚Ä¶" style="width:100%; min-height:70px; background:#0d1233; color:#fff; border:1px solid #25316b; border-radius:10px; padding:10px"></textarea>
      </div>

      <div class="row" style="margin-top:12px; justify-content:flex-end">
        <button id="logRoundBtn" class="btn-primary" aria-label="Log round (L)">üìù Log Round</button>
        <button id="exportBtn">‚¨áÔ∏è Export Log (.csv)</button>
        <button id="resetGameBtn">‚ôªÔ∏è Reset Game</button>
      </div>

      <div style="margin-top:14px" class="muted">Session Log</div>
      <div class="log" aria-live="polite">
        <table id="logTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Emotion</th>
              <th>Skill</th>
              <th>Consensus</th>
              <th>Notes</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <p class="footer-note">Pro tip: After 6‚Äì8 rounds, end with a quick reflection: "Which skills felt universal? Which were state‚Äëspecific? What tweaks made a poor fit workable?"</p>

  <!-- Lists / Settings Modal -->
  <dialog id="settingsModal">
    <div class="modal">
      <header>
        <h3 style="margin:0">‚öôÔ∏è Lists & Settings</h3>
      </header>
      <div class="content">
        <p class="muted" style="margin-top:0">Edit the lists below (one item per line). The wheel will redraw when you save.</p>
        <div class="row">
          <div class="card" style="flex:1; min-width:260px">
            <div class="section-title">üé° Emotional States</div>
            <textarea id="emotionsInput"></textarea>
          </div>
          <div class="card" style="flex:1; min-width:260px">
            <div class="section-title">üÉè Coping Skills</div>
            <textarea id="skillsInput"></textarea>
          </div>
        </div>
        <div class="card" style="margin-top:12px">
          <div class="section-title">üé§ Sponsors (brand | slogan)</div>
          <textarea id="sponsorsInput"></textarea>
        </div>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
          <button id="closeSettingsBtn">Cancel</button>
          <button id="saveSettingsBtn" class="btn-primary">Save & Update</button>
        </div>
      </div>
    </div>
  </dialog>

  <div id="toast" class="sponsor-toast" style="display:none">
    <div>üì£</div>
    <div>
      <div class="brand" id="toastBrand">Avoidance‚Ñ¢</div>
      <div id="toastLine" class="muted">Why feel it when you can flee it.</div>
    </div>
  </div>

<script>
(function(){
  // ---------- Defaults ----------
  const defaultEmotions = [
    "Anxiety","Rage","Grief","Shame","Boredom","Loneliness",
    "Embarrassment","Guilt","Craving","Stress","Jealousy","Hopelessness"
  ];
  const defaultSkills = [
    "Box breathing (4-4-4-4)",
    "5-4-3-2-1 grounding",
    "Urge surfing (10 minutes)",
    "Opposite action",
    "Behavioral activation micro-task",
    "Call/text a support",
    "Music + movement (1 song)",
    "Cold water / TIPP",
    "Progressive muscle relaxation",
    "Coping self-talk script",
    "2-minute journaling",
    "Go outside (fresh air reset)",
    "Stretch sequence (2 minutes)",
    "Name it to tame it",
    "Pros & cons (3 minutes)",
    "Values reminder card",
    "Gratitude blitz (3 items)",
    "Sensory kit (touch/scent)",
    "Humor video (5 minutes)",
    "Short body scan"
  ];
  const defaultSponsors = [
    {brand:"Avoidance‚Ñ¢", slogan:"Why feel it when you can flee it."},
    {brand:"Doomscrolling‚Ñ¢", slogan:"Thumbs up for anxiety."},
    {brand:"Rage Quit¬Æ", slogan:"If at first you don't succeed, flip the table."},
    {brand:"Isolation Inc.", slogan:"Because texting back is hard."},
    {brand:"Magical Thinking‚Ñ¢", slogan:"'This time will be different' since forever."},
    {brand:"People Pleasing Co.", slogan:"Your needs? We'll get back to you."},
    {brand:"Catastrophizing‚Ñ¢", slogan:"Worst-case delivered fast."},
    {brand:"Perfectionism¬Æ", slogan:"If it's not 100%, it's trash."},
    {brand:"Procrastination LLC", slogan:"Later is our specialty."},
    {brand:"Comparison‚Ñ¢", slogan:"Keeping you less-than daily."},
    {brand:"Rumination Labs", slogan:"Replay. Rewind. Regret."}
  ];

  // ---------- State ----------
  let emotions = loadJSON('emotions') || defaultEmotions.slice();
  let skills = loadJSON('skills') || defaultSkills.slice();
  let sponsors = loadJSON('sponsors') || defaultSponsors.slice();

  let rotation = 0; // radians
  let spinning = false;
  let currentEmotion = null;
  let usedSkills = new Set();

  const log = [];

  // ---------- Elements ----------
  const wheel = document.getElementById('wheelCanvas');
  const ctx = wheel.getContext('2d');
  const spinBtn = document.getElementById('spinBtn');
  const currentEmotionEl = document.getElementById('currentEmotion');
  const drawSkillBtn = document.getElementById('drawSkillBtn');
  const skillCard = document.getElementById('skillCard');
  const yesCount = document.getElementById('yesCount');
  const noCount = document.getElementById('noCount');
  const depCount = document.getElementById('depCount');
  const consensusBadge = document.getElementById('consensusBadge');
  const resetVotesBtn = document.getElementById('resetVotesBtn');
  const notesEl = document.getElementById('notes');
  const logTableBody = document.querySelector('#logTable tbody');
  const logRoundBtn = document.getElementById('logRoundBtn');
  const exportBtn = document.getElementById('exportBtn');
  const resetGameBtn = document.getElementById('resetGameBtn');
  const sponsorBtn = document.getElementById('sponsorBtn');

  const settingsBtn = document.getElementById('settingsBtn');
  const settingsModal = document.getElementById('settingsModal');
  const emotionsInput = document.getElementById('emotionsInput');
  const skillsInput = document.getElementById('skillsInput');
  const sponsorsInput = document.getElementById('sponsorsInput');
  const closeSettingsBtn = document.getElementById('closeSettingsBtn');
  const saveSettingsBtn = document.getElementById('saveSettingsBtn');

  const toast = document.getElementById('toast');
  const toastBrand = document.getElementById('toastBrand');
  const toastLine = document.getElementById('toastLine');

  // ---------- Wheel Drawing ----------
  function drawWheel(){
    const W = wheel.width, H = wheel.height;
    ctx.clearRect(0,0,W,H);

    const cx = W/2, cy = H/2, r = Math.min(W,H)/2 - 8;
    const n = emotions.length || 1;
    const slice = Math.PI*2 / n;

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(rotation);

    for(let i=0;i<n;i++){
      const start = i * slice;
      const end = start + slice;
      // segment color
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,r, start, end);
      ctx.closePath();
      const even = i % 2 === 0;
      ctx.fillStyle = even ? '#1a2255' : '#101844';
      ctx.fill();
      ctx.strokeStyle = '#2a2f59';
      ctx.lineWidth = 2;
      ctx.stroke();

      // label
      ctx.save();
      ctx.rotate(start + slice/2);
      ctx.textAlign = 'right';
      ctx.fillStyle = '#dbeafe';
      ctx.font = '16px system-ui, sans-serif';
      wrapArcText(ctx, emotions[i], r - 12, slice*0.9);
      ctx.restore();
    }

    // center dot
    ctx.beginPath();
    ctx.arc(0,0,8,0,Math.PI*2);
    ctx.fillStyle = '#7dd3fc';
    ctx.fill();
    ctx.restore();
  }

  function wrapArcText(ctx, text, radius, maxArc){
    // simple arc text: shrink text if too long
    let size = 18; let t = text;
    ctx.font = `${size}px system-ui, sans-serif`;
    while(ctx.measureText(t).width > radius*1.6 && size>10){
      size -= 1; ctx.font = `${size}px system-ui, sans-serif`;
    }
    ctx.fillText(text, radius-6, 6);
  }

  function pickWinner(){
    // pointer at top (angle = 0 in screen space). Convert rotation to index.
    const n = emotions.length || 1;
    const slice = Math.PI*2 / n;
    const a = (Math.PI*1.5 - rotation) % (Math.PI*2); // align top as 12 o'clock
    const norm = (a + Math.PI*2) % (Math.PI*2);
    let idx = Math.floor(norm / slice);
    if(idx < 0) idx += n;
    return {index: idx, item: emotions[idx]};
  }

  function easeOutCubic(x){ return 1 - Math.pow(1 - x, 3); }

  function spin(){
    if(spinning || emotions.length===0){return}
    spinning = true;
    const extraSpins = (Math.random()*4 + 4) * Math.PI*2; // 4‚Äì8 full turns
    const offset = Math.random()*Math.PI*2; // random stop
    const start = rotation;
    const target = start + extraSpins + offset;

    const dur = 2200 + Math.random()*1200; // ms
    const t0 = performance.now();

    function frame(t){
      const p = Math.min((t - t0)/dur, 1);
      const e = easeOutCubic(p);
      rotation = start + (target - start) * e;
      drawWheel();
      if(p < 1){ requestAnimationFrame(frame) } else {
        spinning = false;
        const win = pickWinner();
        currentEmotion = win.item;
        currentEmotionEl.textContent = currentEmotion;
        // minor focus pulse
        currentEmotionEl.animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}], {duration:400});
      }
    }
    requestAnimationFrame(frame);
  }

  // ---------- Skills Deck ----------
  function drawSkill(){
    if(skills.length===0){ skillCard.textContent = '‚Äî'; return }
    if(usedSkills.size >= skills.length){ usedSkills.clear(); }
    let idx, tries=0;
    do{ idx = Math.floor(Math.random()*skills.length); tries++; if(tries>50) break; }while(usedSkills.has(idx));
    usedSkills.add(idx);
    const s = skills[idx];
    skillCard.textContent = s;
    skillCard.animate([{transform:'translateY(4px)', opacity:.6},{transform:'translateY(0)', opacity:1}], {duration:220});
    return s;
  }

  // ---------- Voting ----------
  let votes = {yes:0, no:0, dep:0};
  function updateConsensus(){
    const {yes,no,dep} = votes;
    let label = '‚Äî', cls='';
    if(yes>no && yes>dep){ label='Will Work'; cls='result-good'; }
    else if(no>yes && no>dep){ label="Won't Work"; cls='result-bad'; }
    else if(dep>yes && dep>no){ label='Depends'; cls='result-dep'; }
    else if(yes+no+dep===0){ label='‚Äî'; }
    else { label='Mixed'; cls=''; }
    consensusBadge.textContent = `Consensus: ${label}`;
    consensusBadge.className = 'badge ' + cls;
  }
  function resetVotes(){ votes = {yes:0,no:0,dep:0}; yesCount.textContent=0; noCount.textContent=0; depCount.textContent=0; updateConsensus(); }

  document.querySelectorAll('[data-vote]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const v = btn.getAttribute('data-vote');
      votes[v]++;
      if(v==='yes') yesCount.textContent=votes[v];
      if(v==='no')  noCount.textContent=votes[v];
      if(v==='dep') depCount.textContent=votes[v];
      updateConsensus();
    })
  })
  resetVotesBtn.addEventListener('click', resetVotes);

  // ---------- Log ----------
  function logRound(){
    const emotion = currentEmotion || '‚Äî';
    const skill = skillCard.textContent || '‚Äî';
    const consensus = consensusBadge.textContent.replace('Consensus: ','');
    const notes = (notesEl.value || '').trim();
    if(emotion==='‚Äî' || skill==='‚Äî'){
      blink([spinBtn, drawSkillBtn]);
      return;
    }
    const row = {emotion, skill, consensus, notes, ts: new Date().toLocaleString()};
    log.push(row);
    renderLog();
    notesEl.value = '';
    resetVotes();
  }

  function renderLog(){
    logTableBody.innerHTML = '';
    log.forEach((r,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td><td>${esc(r.emotion)}</td><td>${esc(r.skill)}</td><td>${esc(r.consensus)}</td><td>${esc(r.notes)}</td><td>${esc(r.ts)}</td>`;
      logTableBody.appendChild(tr);
    })
  }

  function exportCSV(){
    const header = ['#','Emotion','Skill','Consensus','Notes','Timestamp'];
    const rows = log.map((r,i)=>[i+1, r.emotion, r.skill, r.consensus, r.notes.replace(/\n/g,' '), r.ts]);
    const all = [header, ...rows];
    const csv = all.map(row=>row.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
    downloadFile('coping-skills-game-show_log.csv', csv, 'text/csv');
  }

  function resetGame(){
    rotation = 0; currentEmotion = null; drawWheel(); currentEmotionEl.textContent = '‚Äî';
    usedSkills.clear(); skillCard.textContent = '‚Äî'; resetVotes();
    log.length = 0; renderLog();
  }

  // ---------- Sponsors ----------
  function randomSponsor(){ return sponsors[Math.floor(Math.random()*sponsors.length)] }
  let toastTimer=null;
  function showSponsor(){
    const s = randomSponsor();
    toastBrand.textContent = s.brand;
    toastLine.textContent = s.slogan;
    toast.style.display = 'flex';
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toast.style.display='none', 4200);
  }

  // ---------- Settings ----------
  function openSettings(){
    emotionsInput.value = emotions.join('\n');
    skillsInput.value = skills.join('\n');
    sponsorsInput.value = sponsors.map(s=>`${s.brand} | ${s.slogan}`).join('\n');
    settingsModal.showModal();
  }
  function closeSettings(){ settingsModal.close(); }
  function saveSettings(){
    emotions = cleanLines(emotionsInput.value);
    skills = cleanLines(skillsInput.value);
    sponsors = cleanSponsors(sponsorsInput.value);
    saveJSON('emotions', emotions);
    saveJSON('skills', skills);
    saveJSON('sponsors', sponsors);
    usedSkills.clear();
    drawWheel();
    closeSettings();
  }

  // ---------- Utils ----------
  function blink(els){
    (Array.isArray(els)?els:[els]).forEach(el=>{
      el.animate([{filter:'brightness(1)'},{filter:'brightness(1.8)'},{filter:'brightness(1)'}],{duration:420});
    })
  }
  function downloadFile(name, content, type){
    const blob = new Blob([content], {type});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = name; document.body.appendChild(a); a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
  }
  function cleanLines(txt){
    return txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  }
  function cleanSponsors(txt){
    return cleanLines(txt).map(line=>{
      const [brand, slogan] = line.split('|').map(s=>s && s.trim());
      return {brand: brand || 'Sponsor', slogan: slogan || ''};
    })
  }
  function loadJSON(key){ try{ return JSON.parse(localStorage.getItem('csgs_'+key)||'null') }catch(e){ return null } }
  function saveJSON(key,val){ localStorage.setItem('csgs_'+key, JSON.stringify(val)) }
  function esc(s){ return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])) }

  // ---------- Events ----------
  spinBtn.addEventListener('click', spin);
  drawSkillBtn.addEventListener('click', drawSkill);
  sponsorBtn.addEventListener('click', showSponsor);
  logRoundBtn.addEventListener('click', logRound);
  exportBtn.addEventListener('click', exportCSV);
  resetGameBtn.addEventListener('click', resetGame);

  settingsBtn.addEventListener('click', openSettings);
  closeSettingsBtn.addEventListener('click', closeSettings);
  saveSettingsBtn.addEventListener('click', saveSettings);

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase()==='s'){ e.preventDefault(); spin() }
    if(e.key.toLowerCase()==='d'){ e.preventDefault(); drawSkill() }
    if(e.key.toLowerCase()==='v'){ e.preventDefault(); showSponsor() }
    if(e.key.toLowerCase()==='l'){ e.preventDefault(); logRound() }
    if(e.key === '/'){ e.preventDefault(); openSettings() }
    if(e.key === 'Escape' && settingsModal.open){ closeSettings() }
  });

  // ---------- Init ----------
  drawWheel();
})();
</script>
</body>
</html>
